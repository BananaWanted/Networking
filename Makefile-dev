.PHONY: dev_env dev dev-install-dryrun dev-install dev-purge dev-reinstall dev-upgrade dev-status dev-sqitch-init

DEV_HELM_INSTALL_FLAGS = --values values-dev.yaml --set docker_image_path=$(DOCKER_HUB_USERNAME)

dev_env: env_kube_local env_sqitch
	$(MINIKUBE) addons enable dashboard
	$(MINIKUBE) addons open dashboard

dev:
	# make sure you have ran `make dev_env` first
	eval $$(minikube docker-env) && $(MAKE) all

dev-%:
	# make sure you have ran `make dev_env` first
	eval $$(minikube docker-env) && $(MAKE) $*

dev-install:
	$(HELM) install $(DEV_HELM_INSTALL_FLAGS) --name $(RELEASE_NAME) .

dev-install-dryrun:
	$(HELM) install $(DEV_HELM_INSTALL_FLAGS) --debug --dry-run --name $(RELEASE_NAME) .

dev-purge:
	$(HELM) delete --purge $(RELEASE_NAME)

dev-purge-all:
	$(HELM) list -a -q | tee | xargs $(HELM) delete --purge

dev-reinstall: dev-purge dev-install

dev-upgrade:
	$(HELM) upgrade $(DEV_HELM_INSTALL_FLAGS) --force --recreate-pods --wait --install $(RELEASE_NAME) .

dev-status:
	$(HELM) status $(RELEASE_NAME)
